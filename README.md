# ragxuary

RAG ネイティブなドキュメンテーションツール

> **ragxuary** = RAG + sanctuary（聖域）  
> 機密性の高いナレッジを、安全に活用するための場所

## 概要

ragxuary は、セルフホスティング可能なドキュメンテーションサイトに AI チャット機能を組み込んだツールです。社内文書や技術資料をナレッジベースとして蓄積し、RAG による検索・回答生成を行えます。

### 主な特徴

- **セルフホスティング対応** - 機密文書を外部 SaaS に預けるリスクを回避できます
- **プロジェクト単位のアクセス制御** - ドキュメントをプロジェクトごとに管理し、公開するメンバー・グループを柔軟に設定できます
- **権限を考慮した RAG** - AI チャットはユーザーの閲覧権限内の情報のみを参照・引用します
- **Markdown エディタ内蔵** - ブラウザ上でドキュメントを直接作成・編集できます
- **Git リポジトリ同期** - 既存の Markdown ドキュメントをそのまま活用可能。指定したリポジトリ・フォルダと同期し、プロジェクトとして表示します
- **多言語対応** - 日本語・英語の UI 切り替えに対応。パスベースのロケール（`/ja/...`, `/en/...`）で SEO にも配慮

## ドキュメント管理

ragxuary では、2 つのドキュメント管理方式を選択できます。

| 方式           | 概要                                                      |      ブラウザ編集       | ユースケース                                                                      |
| -------------- | --------------------------------------------------------- | :---------------------: | --------------------------------------------------------------------------------- |
| **ネイティブ** | ragxuary 上の Markdown エディタでドキュメントを作成・編集 |         ✅ 可能         | 新規でドキュメントを整備する場合や、非エンジニアも編集に参加する場合              |
| **Git 同期**   | 外部 Git リポジトリの指定フォルダと同期                   | ❌ 不可（読み取り専用） | 既存の Markdown 資産を活用する場合や、PR レビューによる編集フローを維持したい場合 |

Git 同期モードでは、コンフリクト防止のためブラウザからの編集を無効化し、Git リポジトリを Single Source of Truth として扱います。

## 開発背景

近年、ビジネスシーンで RAG（Retrieval-Augmented Generation）の需要が高まっています。蓄積された社内文書、技術資料、規程・ガイドラインをメンバーが素早く参照できることは、多くのチームにとって重要だからです。

一方で、機密性の高い文書を外部の SaaS で管理することにリスクを感じる企業も少なくありません。そこで、セルフホスティング可能なドキュメンテーションサイトをナレッジベースとし、AI チャット機能を備えたツールを構想しました。

また、セキュリティ上の境界は社内・社外だけではありません。特定のメンバーにのみ公開したい情報を AI が意図せず引用してしまう事態は避ける必要があります。そのため、ドキュメントを「プロジェクト」単位で管理し、閲覧権限に基づいて AI の参照範囲を制御する仕組みを設計しました。

## 技術選定

| カテゴリ                  | 技術                                  | 選定理由                                                                                                                       |
| ------------------------- | ------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| フロントエンド            | Next.js, Tailwind CSS, shadcn/ui      | モダンな UI を効率的に構築できる。shadcn/ui により一貫性のあるコンポーネント設計が可能                                         |
| バックエンド              | FastAPI                               | Python の RAG エコシステム（LangChain、LlamaIndex など）との親和性が高い。Next.js の API Routes から分離することで責務を明確化 |
| ベクトル DB               | pgvector                              | PostgreSQL に同居でき、インフラ構成がシンプル。小〜中規模のドキュメント管理に適している                                        |
| キャッシュ/レートリミット | Redis                                 | 外部 LLM API（OpenAI など）利用時のレートリミット・使用量管理に使用。RAG 検索結果のキャッシュによるコスト削減にも活用          |
| LLM                       | OpenAI / Anthropic / Ollama（選択式） | ローカル LLM による完全クローズド運用と、外部 API による高性能モデル利用の両方に対応                                           |
| 国際化                    | next-intl                             | Next.js App Router との親和性が高く、RSC にも対応。パスベースのロケール切り替えを実現                                          |
| テスト（フロントエンド）  | Vitest, React Testing Library, Playwright | 高速な単体テスト、ユーザー視点のコンポーネントテスト、信頼性の高い E2E テストを実現                                        |
| テスト（バックエンド）    | pytest, pytest-asyncio, httpx         | 非同期 API のテストに対応。カバレッジ計測とテストデータ生成を自動化                                                            |
| インフラ                  | Docker Compose                        | セルフホスティングを前提とし、単一コマンドでの環境構築を実現                                                                   |

## セットアップ

### 1. リポジトリのクローン

```bash
git clone https://github.com/tky1094/ragxuary.git
cd ragxuary
```

### 2. 環境変数の設定

```bash
cp .env.example .env
# 必要に応じて .env を編集
```

### 3. 開発環境の起動

```bash
# PostgreSQL と Redis を起動
docker compose up -d

# 起動確認
docker compose ps
```

## 開発

### テストの実行

**バックエンド:**

```bash
cd api

# テスト実行
pytest

# カバレッジ付きで実行
pytest --cov=app --cov-report=html
```

**フロントエンド:**

```bash
cd web

# 単体テスト・コンポーネントテスト
npm run test

# E2E テスト
npx playwright test
```

### テスト方針

| 対象                   | 目標カバレッジ | ツール                          |
| ---------------------- | -------------- | ------------------------------- |
| バックエンド           | 80%+           | pytest, pytest-asyncio, httpx   |
| フロントエンド         | 70%+           | Vitest, React Testing Library   |
| E2E（重要フロー）      | -              | Playwright                      |

詳細なテスト戦略については [docs/REQUIREMENTS.md](docs/REQUIREMENTS.md#テスト戦略) を参照してください。

### API クライアント生成

バックエンドの OpenAPI スキーマから TypeScript クライアントを自動生成しています。

```bash
# API クライアントの再生成
./scripts/generate-client.sh
```

生成されたクライアントは `web/client/` に配置され、型安全な API 呼び出しが可能です。

> **Note:** `api/app/` 配下のファイルが変更されると、CI が自動でクライアントを再生成する PR を作成します。

### Pre-commit フック

コード品質を保つため、pre-commit フックを設定できます。

```bash
# pre-commit のインストール
pip install pre-commit

# フックのインストール
pre-commit install

# 全ファイルに対して手動実行（オプション）
pre-commit run --all-files
```

設定済みのチェック:
- **Python**: ruff (リント・フォーマット)
- **TypeScript**: prettier, eslint

## ドキュメント

- [要件定義書](docs/REQUIREMENTS.md) - 機能要件、非機能要件、テスト戦略、API 設計など
- [開発フロー](docs/DEVELOPMENT.md) - 開発手順、テスト実行、マイグレーション手順など

## License

MIT
